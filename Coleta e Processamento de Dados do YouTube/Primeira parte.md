# Parte 1: Coleta e Processamento de Dados do YouTube

## üìã Vis√£o Geral

Esta primeira parte do workflow √© respons√°vel por **coletar dados brutos do YouTube, processar m√©tricas e armazenar em Google Sheets** para an√°lise posterior.

### Objetivo
Extrair v√≠deos de um nicho espec√≠fico, calcular m√©tricas de performance e engajamento, e organizar os dados de forma estruturada.

---

## üîÑ Fluxo de Execu√ß√£o

```
Formul√°rio ‚Üí Tradu√ß√£o ‚Üí Prepara√ß√£o ‚Üí API Scraping ‚Üí Aguardar ‚Üí Coletar Resultados ‚Üí Processar Dados ‚Üí Dividir ‚Üí Salvar no Sheets
```

---

## üì¶ N√≥s do Workflow

### 1. **On form submission** (Trigger)
**Tipo:** `n8n-nodes-base.formTrigger`

**Fun√ß√£o:** Captura os par√¢metros de busca do usu√°rio atrav√©s de um formul√°rio web.

**Campos do Formul√°rio:**
- **Nicho** (texto, obrigat√≥rio): Termo de busca para o YouTube
- **Quantidade esperada** (n√∫mero, obrigat√≥rio): N√∫mero m√°ximo de resultados
- **Filtro por** (checkbox): Op√ß√µes de ordena√ß√£o
  - Sem Filtro
  - Relev√¢ncia
  - Data do Upload
  - Contagem de visualiza√ß√µes

**Output:**
```json
{
  "Nicho": "weak legs",
  "Quantidade esperada": 50,
  "Filtro por ": ["Contagem de visualiza√ß√µes"],
  "submittedAt": "2025-01-...",
  "formMode": "test"
}
```

---

### 2. **Code in JavaScript1** (Tradutor)
**Tipo:** `n8n-nodes-base.code`

**Fun√ß√£o:** Traduz os valores do formul√°rio em portugu√™s para ingl√™s (formato aceito pela API).

**Mapeamento:**
```javascript
{
  'Sem Filtro': null,
  'Relev√¢ncia': 'relevance',
  'Data do Upload': 'date',
  'Contagem de visualiza√ß√µes': 'views'
}
```

**Output:**
```json
{
  "nicho": "weak legs",
  "quantidade_esperada": 50,
  "sorting_order": "views",
  "submitted_at": "ISO_DATE",
  "form_mode": "test"
}
```

---

### 3. **Edit Fields** (Normaliza√ß√£o)
**Tipo:** `n8n-nodes-base.set`

**Fun√ß√£o:** Padroniza os nomes dos campos para uso nos pr√≥ximos n√≥s.

**Campos Criados:**
- `Nicho` ‚Üê `nicho`
- `Resultado maximo` ‚Üê `quantidade_esperada`
- `Ordem de classifica√ß√£o` ‚Üê `sorting_order`

---

### 4. **HTTP Request** (Iniciar Scraping)
**Tipo:** `n8n-nodes-base.httpRequest`

**Fun√ß√£o:** Inicia o processo de scraping via Apify (YouTube Scraper).

**Configura√ß√£o:**
- **M√©todo:** POST
- **URL:** `https://api.apify.com/v2/acts/streamers~youtube-scraper/runs`
- **API:** Apify Token (autentica√ß√£o)

**Body da Requisi√ß√£o:**
```json
{
  "downloadSubtitles": false,
  "hasCC": false,
  "hasLocation": false,
  "hasSubtitles": false,
  "is360": false,
  "is3D": false,
  "is4K": false,
  "isBought": false,
  "isHD": false,
  "isHDR": false,
  "isLive": false,
  "isVR180": false,
  "maxResultStreams": 0,
  "maxResults": 50,
  "maxResultsShorts": 0,
  "preferAutoGeneratedSubtitles": false,
  "saveSubsToKVS": false,
  "searchQueries": ["weak legs"],
  "sortingOrder": "views"
}
```

**Por que Apify?**
- API robusta e confi√°vel para scraping do YouTube
- Dados estruturados e completos
- N√£o viola ToS do YouTube (usa m√©todos permitidos)
- Rate limiting gerenciado

---

### 5. **Clear sheet** (Limpeza)
**Tipo:** `n8n-nodes-base.googleSheets`

**Fun√ß√£o:** Limpa dados antigos da planilha antes de inserir novos.

**Configura√ß√£o:**
- **Opera√ß√£o:** Clear
- **Documento:** Teste Dev IA Pleno
- **Aba:** DADOSBRUTOS
- **Manter cabe√ßalho:** Sim

---

### 6. **Wait** (Aguardar Processamento)
**Tipo:** `n8n-nodes-base.wait`

**Fun√ß√£o:** Aguarda 10 minutos para o Apify processar os dados do YouTube.

**Configura√ß√£o:**
- **Tempo:** 10 minutos
- **Tipo:** Aguardar antes de continuar

**Por qu√™?**
O scraping do YouTube √© um processo ass√≠ncrono. A API do Apify inicia o job e processa em background. Ap√≥s 10 minutos, os dados estar√£o prontos para coleta.

---

### 7. **HTTP Request1** (Coletar Resultados)
**Tipo:** `n8n-nodes-base.httpRequest`

**Fun√ß√£o:** Busca os dados processados pelo Apify.

**Configura√ß√£o:**
- **M√©todo:** GET
- **URL:** `https://api.apify.com/v2/acts/streamers~youtube-scraper/runs/last/dataset/items`

**Output:** Array de objetos com dados dos v√≠deos:
```json
[
  {
    "id": "video_id",
    "title": "T√≠tulo do v√≠deo",
    "viewCount": 150000,
    "likes": 5000,
    "commentsCount": 320,
    "date": "2024-09-15",
    "duration": "10:24",
    "channelName": "Nome do Canal",
    "numberOfSubscribers": 580000,
    "url": "https://youtube.com/watch?v=...",
    ...
  }
]
```

---

### 8. **Code in JavaScript** (Processamento e C√°lculo de M√©tricas)
**Tipo:** `n8n-nodes-base.code`

**Fun√ß√£o:** Principal n√≥ de processamento. Calcula todas as m√©tricas de performance e engajamento.

#### **M√©tricas Calculadas:**

##### M√©tricas Temporais:
- **diasPublicado**: Dias desde a publica√ß√£o at√© hoje
- **duracaoSegundos**: Dura√ß√£o convertida para segundos
- **formatoVideo**: Classifica√ß√£o (short < 3min, curto < 10min, m√©dio < 20min, longo > 20min)

##### M√©tricas de Engajamento:
- **engagementRate**: `(likes / views) * 100`
- **likeRate**: `(likes / views) * 1000` (por mil visualiza√ß√µes)
- **commentRate**: `(comments / views) * 1000` (por mil visualiza√ß√µes)
- **totalEngagement**: `likes + comments`
- **totalEngagementRate**: `(totalEngagement / views) * 100`

##### M√©tricas de Performance:
- **viewsPerDay**: `views / diasPublicado` (velocidade de crescimento)
- **outlierScore**: `(views / inscritos) * 100` (viraliza√ß√£o acima da m√©dia do canal)

#### **Estat√≠sticas Agregadas:**
```json
{
  "estatisticas": {
    "totalVideos": 50,
    "totalViews": 7500000,
    "totalLikes": 250000,
    "mediaViews": 150000,
    "mediaEngagement": 3.5,
    "mediaOutlier": 45.2,
    "mediaViewsPerDay": 2500,
    "dataProcessamento": "2025-01-18T12:00:00Z",
    "contextoBusca": {
      "nicho": "weak legs",
      "resultadoMaximo": 50,
      "ordemClassificacao": "views"
    }
  }
}
```

#### **Output por V√≠deo:**
```json
{
  "nicho": "weak legs",
  "id": "abc123",
  "titulo": "5 Exerc√≠cios Para Pernas Fracas",
  "link": "https://youtube.com/watch?v=abc123",
  "thumb": "https://i.ytimg.com/...",
  "view": 150000,
  "likes": 5000,
  "comentarios": 320,
  "duracao": "10:24",
  "data": "2024-09-15",
  "idCanal": "UC...",
  "canal": "Sa√∫de Senior",
  "canalLink": "https://youtube.com/@...",
  "inscritos": 580000,
  "diasPublicado": 45,
  "duracaoSegundos": 624,
  "formatoVideo": "m√©dio",
  "engagementRate": 3.33,
  "likeRate": 33.33,
  "commentRate": 2.13,
  "totalEngagement": 5320,
  "totalEngagementRate": 3.55,
  "viewsPerDay": 3333,
  "outlierScore": 25.86
}
```

---

### 9. **Split Out** (Divis√£o de Array)
**Tipo:** `n8n-nodes-base.splitOut`

**Fun√ß√£o:** Transforma o array `videos` em itens individuais para inser√ß√£o no Sheets.

**Configura√ß√£o:**
- **Campo:** `videos`
- **Incluir outros campos:** Sim (mant√©m `estatisticas`)

---

### 10. **Append row in sheet** (Salvamento)
**Tipo:** `n8n-nodes-base.googleSheets`

**Fun√ß√£o:** Insere cada v√≠deo processado como uma linha no Google Sheets.

**Colunas da Planilha:**
1. Termo de Pesquisa
2. Filtro
3. ID
4. Titulo
5. Link
6. Thumb
7. View
8. Likes
9. Comentarios
10. Dura√ß√£o
11. Data
12. IDCanal
13. Canal
14. CanalLink
15. Inscritos
16. Diaspublicados
17. DuracaoSecundos
18. FormatoVideo
19. EngajamentoRate
20. LikeRate
21. CommetRate
22. totalEngagement
23. totalEngagementRate
24. viewsPerDay
25. outlierScore

**Documento:** `1XlZTABwHA456bYCFRiS8BFLxynypmo65pXeBeRV1WkQ`
**Aba:** DADOSBRUTOS

---

## üìä Dados Finais Gerados

### Estrutura no Google Sheets
Cada linha representa um v√≠deo com:
- **Identifica√ß√£o**: ID, T√≠tulo, Link, Thumbnail
- **M√©tricas Brutas**: Views, Likes, Coment√°rios, Dura√ß√£o, Data
- **Dados do Canal**: ID, Nome, Link, Inscritos
- **M√©tricas Calculadas**: 
  - Engajamento (rates)
  - Performance (views/dia, outlier score)
  - Classifica√ß√£o (formato, dias publicados)

### Uso dos Dados
Estes dados processados servem como base para:
- An√°lise de padr√µes (Parte 2)
- Identifica√ß√£o de outliers
- Gera√ß√£o de insights com LLM (Parte 3)
- Score final de oportunidades (Parte 4)

---

## ‚öôÔ∏è Configura√ß√µes T√©cnicas

### APIs Utilizadas
- **Apify (YouTube Scraper)**: Coleta de dados
  - Token: Configurado via vari√°vel de ambiente
  - Rate limit: Gerenciado pelo Apify
- **Google Sheets API**: Armazenamento
  - Autentica√ß√£o OAuth2
  - Credenciais: `KrBqg4twP2wKcI6z`

### Tempo de Execu√ß√£o
- Formul√°rio ‚Üí Iniciar Scraping: ~2 segundos
- Aguardar processamento: 10 minutos (fixo)
- Coletar e processar: ~30 segundos
- Salvar no Sheets: ~10 segundos por v√≠deo
- **Total estimado**: ~12-15 minutos para 50 v√≠deos

### Limita√ß√µes
- M√°ximo de resultados: Configur√°vel no formul√°rio
- Tempo de espera fixo: 10 minutos (pode ser ajustado)
- Rate limit do Apify: Depende do plano contratado

---

## üéØ Resultado Final da Parte 1

**Input:** Nicho + Quantidade + Filtro  
**Output:** Planilha Google Sheets com dados estruturados e m√©tricas calculadas

**Pr√≥xima Etapa:** Os dados do Sheets ser√£o utilizados na Parte 2 para an√°lise de padr√µes e identifica√ß√£o de oportunidades.
